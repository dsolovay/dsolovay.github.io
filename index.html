<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Explorations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Explorations">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Explorations">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Explorations">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Explorations" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Explorations</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">into Sitecore and .Net</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/25/hello-world/" class="article-date">
  <time datetime="2015-11-25T19:26:32.910Z" itemprop="datePublished">2015-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/25/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/25/hello-world/" data-id="cihfd0n7m0001jcz5llxajq6m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Creating-MongoDB-Shards-and-Replica-Sets-with-PowerShell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/25/Creating-MongoDB-Shards-and-Replica-Sets-with-PowerShell/" class="article-date">
  <time datetime="2015-11-25T11:00:00.000Z" itemprop="datePublished">2015-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/25/Creating-MongoDB-Shards-and-Replica-Sets-with-PowerShell/">Creating MongoDB Shards and Replica Sets with PowerShell</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In the MongoDB University course “M101N: MongoDB for .NET Developers”, there is a walk through of a UNIX script to create a 3x3 set of shards and replica sets. To brush up on my MongoDB and my Powershell, I decided this weekend to try to rewrite and extend the script in Powershell. A somewhat painful, but ultimately rewarding, experience: You can see what I came up with <a href="https://gist.github.com/dsolovay/f098e10df9d7dd91b1ab" title="PowerShell gist" target="_blank" rel="external">here</a>.  In this post I will walk through some of the PowerShell and some of the MongoDB syntax and tricks.</p>
<h2 id="General_Approach">General Approach</h2><p>I wanted to be able to run the script multiple times, so I decided to put my data directories under c:\temp, and to delete them at the start of the run.  Similarly, I spawn all the “mongod” processes as windows, so they are easy to kill with a right click on the task bar.  (I didn’t want to kill all mongod processes, because I didn’t want to touch the one running as a service, that supports my Development Sitecore instances.)  Also, I used simple values for my port numbers: the mogod processes run as 30000 to 30008, the configuration servers as 40000, 400001, 400002, and the mongos (which functions as a router in a sharded environment) on port 50000.  I also have added some diagnostics to check on statuses of various steps in the processed, rather than simply waiting for an arbitrary 60 seconds, as the original script does.</p>
<h2 id="Clean_Up,_Set_Up">Clean Up, Set Up</h2><p>The script begins by establishing a temporary directory, cleaning up an old copy and creating an output function, “report”, to facilitate nicely formatted status reporting.  The output is piped to Out-Null to keep the output stream clean.</p>
<pre><code><span class="variable">$rootpath</span> = <span class="string">"/temp/mongoshards/"</span>

new-module  -scriptblock {function report(<span class="variable">$text</span>) {
write-output $(<span class="string">"-"</span> * <span class="variable">$text</span>.length)
write-output <span class="variable">$text</span>
write-output $(<span class="string">"-"</span> * <span class="variable">$text</span>.length)
write-output <span class="string">""</span>
}}  | Out-Null

report <span class="string">"Remove temporary directory"</span>

remove-item <span class="variable">$rootpath</span> -recurse 

report <span class="string">"Create data directories"</span>

new-item -type directory -path <span class="variable">$rootpath</span> | Out-Null

report <span class="string">"Create mongod instances"</span>
</code></pre><h2 id="Creating_the_Mongod_processes">Creating the Mongod processes</h2><p>The logic to create the mongod processes is pretty straight-forward:</p>
<pre><code>report <span class="string">"Create mongod instances"</span>

<span class="variable">$shards</span> = <span class="number">0</span>..<span class="number">2</span>
foreach (<span class="variable">$shard</span> <span class="keyword">in</span> <span class="variable">$shards</span>)
{

  <span class="variable">$rss</span> = <span class="number">0</span>..<span class="number">2</span>
  foreach (<span class="variable">$rs</span> in <span class="variable">$rss</span>)
  {
    <span class="variable">$dbpath</span> = <span class="string">"$rootpath/data/shard${shard}/r${rs}"</span>
    new-item -type directory -path <span class="variable">$dbpath</span> | Out-Null

    # Start mongod processes
    <span class="variable">$port</span> = <span class="number">30000</span> + (<span class="variable">$shard</span> * <span class="number">3</span>) + <span class="variable">$rs</span>
    <span class="variable">$args</span> = <span class="string">"--replSet s$shard --logpath $rootpath/s${shard}_r${rs}.log --dbpath $dbpath --port $port --oplogSize 64 --smallfiles"</span>
    <span class="variable">$process</span> = start-process mongod.exe <span class="variable">$args</span>  
  }
</code></pre><p>The only trickiness here is the variable substitution, leading to paths like “data/shard0/r1”, and the logic to create the port numbers, 30000,30001,30002 for the shard 0 processes, 30003-30005 for s1, and 30006-30008 for s2.  Of course, these are not yet replica sets; we handle that next.</p>
<h2 id="Creating_the_Replica_Sets">Creating the Replica Sets</h2><p>This is done by creating a config document and passing it to rs.initialize.</p>
<pre><code>report <span class="string">"Configure replica sets"</span>

  <span class="variable">$port1</span> = <span class="number">30000</span> + <span class="variable">$shard</span> * <span class="number">3</span>
  <span class="variable">$port2</span> = <span class="number">30000</span> + <span class="variable">$shard</span> * <span class="number">3</span> + <span class="number">1</span>     
  <span class="variable">$port3</span> = <span class="number">30000</span> + <span class="variable">$shard</span> * <span class="number">3</span> + <span class="number">2</span>

  <span class="variable">$configBlock</span> = <span class="string">"{_id: ""s$shard"", members: [ {_id:0, host:""localhost:$port1""}, {_id:1, host:""localhost:$port2""}, {_id:2, host:""localhost:$port3""}]}"</span>
  echo <span class="string">"rs.initiate($configBlock)"</span> | mongo --port <span class="variable">$port1</span>  
</code></pre><p>The echo “javascript” | mongo is a nice bit of syntax I picked up from the course, and simplifies passing MongoDB commands from a script.  Since it takes a little while for a server to win an election and become a PRIMARY, we set up a one second loop to look for this event:</p>
<pre><code>report <span class="string">"Check PRIMARY elected for each replica set"</span>

<span class="keyword">while</span> (<span class="variable">$True</span>)
{
  <span class="variable">$response1</span> = (echo <span class="string">"rs.status()"</span> | mongo -port <span class="number">30000</span>)
  <span class="variable">$response2</span> = (echo <span class="string">"rs.status()"</span> | mongo -port <span class="number">30003</span>)
  <span class="variable">$response3</span> = (echo <span class="string">"rs.status()"</span> | mongo -port <span class="number">30006</span>)


  if ((<span class="variable">$response1</span> -clike <span class="string">"*PRIMARY*"</span>) -and (<span class="variable">$response2</span> -clike <span class="string">"*PRIMARY*"</span>) -and (<span class="variable">$response3</span> -clike <span class="string">"*PRIMARY*"</span>)) {
    break
   }
  Start-Sleep -s <span class="number">1</span>
  Write-Output <span class="string">"."</span>
}

report <span class="string">"PRIMARY elected"</span>
</code></pre><p>Note that redirected output creates an array of strings, and the comparison operator -clike checks for a case sensitive match for any member of such an array.</p>
<h2 id="Creating_the_Shards">Creating the Shards</h2><p>Two steps are left to create the shards.  First, we need to create the configuration servers that will store which records go where, and then we need to define each replica set as a shard.  Finally, we need to specify the collection and key that will be used for sharding the data.</p>
<pre><code><span class="title">report</span> <span class="string">"Create config servers"</span>

<span class="variable">$cfg_a</span> = <span class="string">"<span class="variable">${rootpath}</span>/data/config_a"</span>
<span class="variable">$cfg_b</span> = <span class="string">"<span class="variable">${rootpath}</span>/data/config_b"</span>
<span class="variable">$cfg_c</span> = <span class="string">"<span class="variable">${rootpath}</span>/data/config_c"</span>

new-item -type directory -path <span class="variable">$cfg_a</span>
new-item -type directory -path <span class="variable">$cfg_b</span>
new-item -type directory -path <span class="variable">$cfg_c</span>

<span class="variable">$arg_a</span> = <span class="string">"--dbpath <span class="variable">$cfg_a</span> --logpath <span class="variable">${rootpath}</span>/cfg-a.log --configsvr --smallfiles --port 40000"</span>
<span class="variable">$arg_b</span> = <span class="string">"--dbpath <span class="variable">$cfg_b</span> --logpath <span class="variable">${rootpath}</span>/cfg-b.log --configsvr --smallfiles --port 40001"</span>
<span class="variable">$arg_c</span> = <span class="string">"--dbpath <span class="variable">$cfg_c</span> --logpath <span class="variable">${rootpath}</span>/cfg-c.log --configsvr --smallfiles --port 40002"</span>

start-process mongod <span class="variable">$arg_a</span>
start-process mongod <span class="variable">$arg_b</span>
start-process mongod <span class="variable">$arg_c</span>

report <span class="string">"Config servers up"</span>
</code></pre><p>Two configuration servers stores the definitive version of what data resides where; the <code>mongos</code> instances keep this data in memory.</p>
<p>Once the configuration servers are set up, the next step is to add the shards. Note the step to make sure that port 50000 is on line.  Basically, if the response does not contains a line with the word “failed”, the server is treated as on-line.</p>
<pre><code>report <span class="string">"Launch mongos"</span>

<span class="variable">$args_s</span> = <span class="string">"--port 50000 --logpath <span class="variable">${rootpath}</span>/mongos-1.log --configdb localhost:40000,localhost:40001,localhost:40002"</span>
start-process mongos <span class="variable">$args_s</span>

report <span class="string">"Check mongos online on port 50000"</span>

<span class="keyword">while</span>(<span class="variable">$true</span>)
{

  <span class="variable">$output</span> = <span class="built_in">echo</span> <span class="string">""</span> |  mongo localhost:<span class="number">50000</span> <span class="number">2</span>&gt; null

  <span class="keyword">if</span> (-not (<span class="variable">$output</span> -like <span class="string">"*failed*"</span>)) {<span class="built_in">break</span>} 

  Start-Sleep <span class="operator">-s</span> <span class="number">1</span>
  Write-Output <span class="string">"."</span>
}
report <span class="string">"Mongos avaiable at port 50000"</span>

report <span class="string">"Configure shards"</span>

<span class="built_in">echo</span> <span class="string">"db.adminCommand( { addshard: "</span><span class="string">"s0/localhost:30000"</span><span class="string">" })"</span> | mongo  --quiet  --port <span class="number">50000</span> 

<span class="built_in">echo</span> <span class="string">"db.adminCommand( { addshard: "</span><span class="string">"s1/localhost:30003"</span><span class="string">" })"</span> | mongo  --quiet --port <span class="number">50000</span> 

<span class="built_in">echo</span> <span class="string">"db.adminCommand( { addshard: "</span><span class="string">"s2/localhost:30006"</span><span class="string">" })"</span> | mongo  --quiet --port <span class="number">50000</span> 

<span class="built_in">echo</span> <span class="string">"db.adminCommand( { enableSharding:"</span><span class="string">"school"</span><span class="string">" })"</span> | mongo --port <span class="number">50000</span> 

<span class="built_in">echo</span> <span class="string">"db.adminCommand( { shardCollection:"</span><span class="string">"school.students"</span><span class="string">", key:{student_id:1} })"</span> | mongo --port <span class="number">50000</span> 
</code></pre><h2 id="Loading_some_data">Loading some data</h2><p>To get some data, I use a short JavaScript (from MongoDB University) that pushes a list of students and course grades.    Once this is done, I display the counts for the combined shared collection, and for each of the specific shards, and the output of sh.status(), which shows the breakpoints that MongoDB is using to distribute data. </p>
<pre><code>report <span class="string">"Generate 100,000 documents"</span> 

$mongoUniversityScript = <span class="string">"db=db.getSiblingDB(`"</span>school`<span class="string">");
types = ['</span><span class="transposed_variable">exam'</span>, <span class="string">'quiz'</span>, <span class="string">'homework'</span>, <span class="string">'homework'</span>];
<span class="comment">// 10,000 students</span>
<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) {

    <span class="comment">// take 10 classes</span>
    <span class="keyword">for</span> (class_counter = <span class="number">0</span>; class_counter &lt; <span class="number">10</span>; class_counter ++) {
 scores = <span class="matrix">[]</span>
     <span class="comment">// and each class has 4 grades</span>
     <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) {
  <span class="transposed_variable">scores.</span>push({<span class="string">'type'</span>:types<span class="matrix">[j]</span>,<span class="string">'score'</span>:<span class="transposed_variable">Math.</span>random()*<span class="number">100</span>});
     }

 <span class="comment">// there are 500 different classes that they can take</span>
 class_id = <span class="transposed_variable">Math.</span><span class="built_in">floor</span>(<span class="transposed_variable">Math.</span>random()*<span class="number">501</span>); <span class="comment">// get a class id between 0 and 500</span>

 record = {<span class="string">'student_id'</span>:i, <span class="string">'scores'</span>:scores, <span class="string">'class_id'</span>:class_id};
 <span class="transposed_variable">db.</span><span class="transposed_variable">students.</span>insert(record);

    }

}<span class="string">"

echo $mongoUniversityScript | mongo --port 50000 --quiet

report "</span>Total records, records in shard <span class="number">1</span>, <span class="number">2</span>, <span class="built_in">and</span> <span class="number">3</span><span class="string">"

echo "</span><span class="transposed_variable">db.</span><span class="transposed_variable">students.</span>count()<span class="string">" | mongo school --port 50000

echo "</span><span class="transposed_variable">db.</span><span class="transposed_variable">students.</span>count()<span class="string">" | mongo school --port 30000

echo "</span><span class="transposed_variable">db.</span><span class="transposed_variable">students.</span>count()<span class="string">" | mongo school --port 30003

echo "</span><span class="transposed_variable">db.</span><span class="transposed_variable">students.</span>count()<span class="string">" | mongo school --port 30006

report "</span><span class="transposed_variable">sh.</span>status() output<span class="string">" 

echo "</span><span class="transposed_variable">sh.</span>status()<span class="string">" | mongo --port 50000</span>
</code></pre><p>Again, I have a link to the full script at the top of the page.  I’m a rank beginner at PowerShell, so please feel free to make suggestions about how style and substance could be improved.  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/25/Creating-MongoDB-Shards-and-Replica-Sets-with-PowerShell/" data-id="cihfd0n7t0008jcz5i92ggfv5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PowerShell/">PowerShell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-My-New-Post" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/24/My-New-Post/" class="article-date">
  <time datetime="2015-11-24T17:13:14.000Z" itemprop="datePublished">2015-11-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/24/My-New-Post/">My New Post</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Subheading">Subheading</h2><p>Some discursive text.</p>
<pre><code><span class="tag">&lt;html&gt;</span>
<span class="keyword">This</span> is code.
<span class="tag">&lt;/html&gt;</span>
</code></pre><p>I could get <em>used</em> to this. This is <strong>easy</strong>!!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/24/My-New-Post/" data-id="cihfd0n7p0002jcz5af9f4418" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Custom-Sitecore-Log-Files" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/18/Custom-Sitecore-Log-Files/" class="article-date">
  <time datetime="2015-11-18T11:00:00.000Z" itemprop="datePublished">2015-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/18/Custom-Sitecore-Log-Files/">Custom Sitecore Log Files</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Starting with Sitecore 6.2, and especially since Sitecore 7 we’ve seen an increase in specific log files: WebDAV, Crawling, Search, Publishing, FXM. This is completely configurable, and can be leveraged to keep your application logic separate from the Sitecore log file while still using Sitecore’s logging capabilities.<br>To create a custom log file, you need to do the following three things:</p>
<ol>
<li><p>Add an appender in the <log4net> section of web.config (or Sitecore.config after 8.1).  </log4net></p>
<pre><code><span class="tag">&lt;<span class="title">appender</span> <span class="attribute">name</span>=<span class="value">"MyAppender"</span> <span class="attribute">type</span>=<span class="value">"log4net.Appender.SitecoreLogFileAppender, Sitecore.Logging"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">file</span> <span class="attribute">value</span>=<span class="value">"$(dataFolder)/logs/MyLog.log.{date}.txt"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">appendToFile</span> <span class="attribute">value</span>=<span class="value">"true"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">layout</span> <span class="attribute">type</span>=<span class="value">"log4net.Layout.PatternLayout"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">conversionPattern</span> <span class="attribute">value</span>=<span class="value">"%4t %d{ABSOLUTE} %-5p %m%n"</span> /&gt;</span>
  <span class="tag">&lt;/<span class="title">layout</span>&gt;</span>
  <span class="tag">&lt;<span class="title">encoding</span> <span class="attribute">value</span>=<span class="value">"utf-8"</span> /&gt;</span>
<span class="tag">&lt;/<span class="title">appender</span>&gt;</span>
</code></pre><p>These are the values Sitecore uses for its log file.  You might want to add <immediateflush>true</immediateflush> if you want to avoid waiting for the buffer to flush.</p>
</li>
<li><p>Reference the Appender in a logger element.  </p>
<pre><code>&lt;logger name=<span class="string">"My.Namespace"</span> additivity=<span class="string">"false"</span>&gt;
&lt;level value=<span class="string">"INFO"</span> /&gt;
&lt;appender-<span class="keyword">ref</span> <span class="keyword">ref</span>=<span class="string">"MyAppender"</span> /&gt;
 &lt;/logger&gt;  
</code></pre><p>Name the logger after your root namespace. If you want to divide different parts of your application into separate logs, you can drive this by being more specific in your namespace.  The level value control what types of messages get written. You can use Debug messages in your classes, and only show this information if you set level to DEBUG.  INFO is the normal setting, which also shows FATAL, ERROR, and WARNING messages, as well as Sitecore’s custom AUDIT message.   </p>
</li>
<li><p>Write messages using Sitecore’s log class, passing a reference to the current object.</p>
<pre><code><span class="keyword">Log</span>.Info(<span class="string">"Your message"</span>, this);
<span class="keyword">Log</span>.<span class="keyword">Debug</span>(<span class="string">"Your message"</span>, this);
<span class="keyword">Log</span>.Error(exception, this);  
<span class="keyword">Log</span>.Audit(<span class="string">"Your message"</span>, this);
</code></pre><p>The Log.Debug message will only show up if logging is set to DEBUG, which makes this setting ideal for detailed instrumentation.  In addition, AUDIT captures information about who performed the action, writing the results as an INFO messages with the domain and username of the user performing the action.</p>
</li>
</ol>
<p>A few additional notes:</p>
<ol>
<li>With Sitecore 8.1, the Log4Net section is moved inside the <sitecore> configuration node, which means it can be added to using Sitecore App_Config/Include patch config files.  </sitecore></li>
<li>You can have several loggers point to the same appender, which might allow you to group your info with that of a specific Sitecore namespace, of to run part of your application with DEBUG logging, and the rest with INFO logging.  </li>
<li>Sitecore Log Analyzer is a great tool for working with log data once you’ve collected it.  For example, it allows you to view just errors, or just one kind of error.  </li>
<li>Log4Net documentation recommends checking if a log message is enabled before writing to it, to save on milliseconds of processing time for creating the string message (e.g. for concatenating a string). This is no longer possible with Sitecore’s wrapper around log4net, as <code>Log.IsDebugEnabled()</code>, for example, is a static method, so there is no way to examine the level setting for a given namespace.  </li>
</ol>
<p>Props to Mark Ursino for blogging about custom log files way back in 2011, and to Kamraz Juman for pointing out the Log.Info(“message”, this) syntax in the comments.  <a href="http://firebreaksice.com/write-to-a-custom-sitecore-log-with-log4net/" target="_blank" rel="external">http://firebreaksice.com/write-to-a-custom-sitecore-log-with-log4net/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/18/Custom-Sitecore-Log-Files/" data-id="cihfd0n7q0003jcz52s5fzum3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Logging/">Logging</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sitecore/">Sitecore</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-A-RoboMongo-Trick" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/04/A-RoboMongo-Trick/" class="article-date">
  <time datetime="2015-11-04T11:00:00.000Z" itemprop="datePublished">2015-11-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/04/A-RoboMongo-Trick/">A RoboMongo Trick</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>RoboMongo is a nice tool for digging around xDB databases. It provides the full feature set of the JavaScript shell (you can save variables, run help commands, etc.) and allows you to do things like edit documents directly through the JSON display.</p>
<p>One small annoyance, however, is that it is difficult to search by GUIDs.  Guids in MongoDB are a tricky business.  They are represented as binary objects, displayed by the format</p>
<pre><code><span class="function"><span class="title">BinData</span><span class="params">(<span class="number">3</span>,<span class="string">"n1UNEaXe6kKcHIpd9+cO+Q=="</span>)</span></span>
</code></pre><p>You can get at the underlying hex value by typing</p>
<pre><code><span class="function"><span class="title">BinData</span><span class="params">(<span class="number">3</span>,<span class="string">"n1UNEaXe6kKcHIpd9+cO+Q=="</span>)</span></span>.<span class="function"><span class="title">hex</span><span class="params">()</span></span>
</code></pre><p>which will give you <code>9f550d11a5deea429c1c8a5df7e70ef9</code> which looks a lot like a GUID. But is not one, for arcane historical reasons.  (Basically, Microsoft has a somewhat idiosyncratic way of arranging the bytes in the Guid.ToString() method.  More info here: <a href="http://stackoverflow.com/questions/3320501/why-isnt-guid-tostringn-the-same-as-a-hex-string-generated-from-a-byte-arra" target="_blank" rel="external">http://stackoverflow.com/questions/3320501/why-isnt-guid-tostringn-the-same-as-a-hex-string-generated-from-a-byte-arra</a></p>
<p>The value <code>BinData(3,&quot;n1UNEaXe6kKcHIpd9+cO+Q==&quot;)</code> actually corresponds <code>110d559f-dea5-42ea-9c1c-8a5df7e70ef9</code>, the ID of the Sitecore Home item.  There are two ways you can make this conversion.  While using the Mongo shell, you can load the JavaScript file uuidhelpers.js (Save it to c:\tools\uuidhelpers.js, and then run <code>load(&quot;c:\\tools\\uuidhelpers.js&quot;)</code>.  </p>
<p>This will give you two useful functions:</p>
<ul>
<li><code>CSUUID(&quot;some guid&quot;)</code>, which generates a proper mongo BinData guid for your .NET Guid, </li>
<li><code>.toCSUUID()</code>, which gives a GUID display for a BinData item. <code>BinData(3,&quot;n1UNEaXe6kKcHIpd9+cO+Q==&quot;).toCSUUID()</code> returns <code>CSUUID(&quot;110d559f-dea5-42ea-9c1c-8a5df7e70ef9&quot;)</code>.</li>
</ul>
<p>It’s a nice feature of this script, and very keeping in the way MongoDB does things, that the representation of the GUID is in the form of the constructor for the BinData object. It makes round-tripping painless, since you can now do things like:</p>
<pre><code>db.Interactions.findOne({<span class="string">"Page.Item._id"</span>: CSUUID(<span class="string">"110d559f-dea5-42ea-9c1c-8a5df7e70ef9"</span>) })
</code></pre><p>Which makes a lot more sense then</p>
<pre><code>db.Interactions.findOne({<span class="string">"Page.Item._id"</span>: BinData(3,<span class="string">"n1UNEaXe6kKcHIpd9+cO+Q=="</span>) })
</code></pre><p>to us Sitecore/.Net people.</p>
<p>Or you could use RoboMongo, which has a nifty Legacy UUID menu:<br><img src="http://i.imgur.com/HGzdzIh.png" alt=""></p>
<p>The .Net setting will display Guids like this:<br><img src="http://i.imgur.com/VZp1Op0.png" alt=""></p>
<p>This is an improvement, but still not ideal, as the NUUID value is not a JS constructor, so you can’t use the Guid to query for docuemnts.</p>
<p>For example, this would not work to find all interactions that visited the home item:<br><img src="http://i.imgur.com/Gkuo5zX.png" alt=""></p>
<p>Similarly, you cannot go from a contact ID here to one in the Contacts table, since you cannot use the displayed GUID field.   This is even a problem if you use Do Not Encode, which still displays the ID in a non-queryable format LUUID(“ guid “), which will again return a not-defined JS error:<br><img src="http://i.imgur.com/Gkuo5zX.png" alt=""></p>
<p>The way around this is simple. These formats only come into play if the variable is part of a larger JSON display.  If you query the value in isolation, you get the original BinData value:</p>
<pre><code>db<span class="class">.Interactions</span><span class="class">.findOne</span>()<span class="class">.Pages</span>[<span class="number">0</span>]<span class="class">.Item</span>._id
</code></pre><p>returns a BinData representation:<br><img src="http://i.imgur.com/kYsOWrJ.png" alt=""></p>
<p>You can also store this to a variable, like this:</p>
<pre><code><span class="tag">var</span> homeId = db<span class="class">.Interactions</span><span class="class">.findOne</span>()<span class="class">.Pages</span>[<span class="number">0</span>]<span class="class">.Item</span>._id
</code></pre><p>Which allows you to run queries like this one:</p>
<pre><code>db.Interactions.<span class="keyword">find</span>({<span class="string">"Pages.Item._id"</span>: homeId})
</code></pre><p>And now we have round-tripping. Also useful, as I mentioned above, for looking up contacts by ID in the db.Contacts collection.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/04/A-RoboMongo-Trick/" data-id="cihfd0n7w000djcz5lbdnpz40" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Developer-Tools/">Developer Tools</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sitecore/">Sitecore</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xDB/">xDB</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Developer-Tools/">Developer Tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logging/">Logging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PowerShell/">PowerShell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sitecore/">Sitecore</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xDB/">xDB</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Developer-Tools/" style="font-size: 10px;">Developer Tools</a> <a href="/tags/Logging/" style="font-size: 10px;">Logging</a> <a href="/tags/MongoDB/" style="font-size: 20px;">MongoDB</a> <a href="/tags/PowerShell/" style="font-size: 10px;">PowerShell</a> <a href="/tags/Sitecore/" style="font-size: 20px;">Sitecore</a> <a href="/tags/xDB/" style="font-size: 10px;">xDB</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/11/25/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/11/25/Creating-MongoDB-Shards-and-Replica-Sets-with-PowerShell/">Creating MongoDB Shards and Replica Sets with PowerShell</a>
          </li>
        
          <li>
            <a href="/2015/11/24/My-New-Post/">My New Post</a>
          </li>
        
          <li>
            <a href="/2015/11/18/Custom-Sitecore-Log-Files/">Custom Sitecore Log Files</a>
          </li>
        
          <li>
            <a href="/2015/11/04/A-RoboMongo-Trick/">A RoboMongo Trick</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Dan Solovay<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>